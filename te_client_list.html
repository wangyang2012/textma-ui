<!DOCTYPE html>
<html>
	<head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>Clients</title>
        <link rel="stylesheet" href="include/css/bootstrap.css" type="text/css" charset="utf-8">
        <link rel="stylesheet" href="include/css/webix.css" type="text/css" charset="utf-8">
        <link rel="stylesheet" href="include/css/material.css" type="text/css" charset="utf-8">
		<link rel="stylesheet" href="include/css/material.min.css">

        <script src="include/js/common.js" type="text/javascript" charset="utf-8"></script>
        <script src="include/js/webix.js" type="text/javascript" charset="utf-8"></script>
        <script src="include/js/skin.js" type="text/javascript" charset="utf-8"></script>
		<script defer src="include/js/material.min.js"></script>
	</head>
	<body>
        <div id="menu"></div>

		<h1>Clients</h1>

        <div class="row col-md-12">
		    <div id="select_page" class="col-md-2"></div>
            <div class="col-md-9 input-group"><input type="text" class="col-md-6 form-control" id='myfilter'><input type="button" class="btn bg_primary button_raised col-md-1 ml-1 mr-1" value='chercher' onclick='search();'><button class="btn bg_success" onclick="showHideColumnMenu()"><span class='webix_icon bg_success fa-bars'></span></button></div>
        </div>

		<div id="grid" class="col-md-12" style='width:100%; height:50%;'></div>
		<div id="paging_here"></div>
		<div id="selectedRow"></div>
		<script type="text/javascript" charset="utf-8">

            function search(){
                pageSize = grida.getPager().data.size;
                grida.clearAll();
                grida.load("http://localhost:9090/textma/teClients?search="+document.getElementById("myfilter").value+"&count="+pageSize);
            }
            webix.ready(function(){

                webix.ui({
                    container:"menu",
                    view:"menu",
                    autowidth:true,
                    data:[
                        { id:"1",value:"TEXTMA"},
                        { id:"2",value:"Accueil"},
                        { id:"3",value:"Client", submenu:[ "Clients", "Fournisseurs", "Familles clients", "Clients principaux", "Contacts", "Location longue durée" ]},
                        { id:"4",value:"Articles", width: 500,
                            submenu:[ "Facebook", "Google+", "Twitter" ]},
                        { id:"5",value:"Vente",
                            submenu:[ "Commandes", "Google+ Site", "Twitter Site" ]},
                        { id:"6",value:"Facturation",
                            submenu:[ "Facebook Site - Social Network", "Google+", "Twitter" ]},
                        { id:"7",value:"Préparation",
                            submenu:[ "Facebook Site - Social Network", "Google+", "Twitter" ]},
                        { id:"8",value:"Confection",
                            submenu:[ "Facebook Site - Social Network", "Google+", "Twitter" ]},
                        { id:"9",value:"Logistique",
                            submenu:[ "Facebook Site - Social Network", "Google+", "Twitter" ]},
                        { id:"10",value:"Production",
                            submenu:[ "Facebook Site - Social Network", "Google+", "Twitter" ]},
                        { id:"11",value:"Stock",
                            submenu:[ "Facebook Site - Social Network", "Google+", "Twitter" ]},
                        { id:"12",value:"Statistiques",
                            submenu:[ "Facebook Site - Social Network", "Google+", "Twitter" ]},
                        { id:"13",value:"Administration",
                            submenu:[ "Facebook Site - Social Network", "Google+", "Twitter" ]}
                    ],
                    type:{
                        subsign:false,
                        height: 50
                    }
                });

                grida = webix.ui({
                    container:"grid",
                    view:"datatable",
                    select:"row",
                    autowidth:true,
                    height:(window.innerHeight*0.77),
                    datafetch:50,
                    dragColumn:true,
                    columns:[
                        { id:"m",                       sort:"server",		header:"M", 		            adjust:"data"},
                        { id:"bloque",					sort:"server",		header:"Bloqué", 		        adjust:"head",	checkValue:'1', uncheckValue:'0', template:"{common.checkbox()}"},
                        { id:"ferme",					sort:"server",		header:"Fermé", 		        adjust:"head",	checkValue:'1', uncheckValue:'0', template:"{common.checkbox()}"},
                        { id:"derniereModification",    sort:"server",		header:"Modification", 			adjust:"head",  format:formatDatetime},
                        { id:"codeClient",				sort:"server",		header:"Code", 		        	adjust:"head"},
                        { id:"nom",                    	sort:"server",		header:"Société", 		        adjust:"data"},
                        { id:"siret",                   sort:"server",		header:"Siret",                 adjust:"data" },
                        { id:"rcs",                     sort:"server",		header:"RCS",                   adjust:"data" },
                        { id:"famille",                 sort:"server",		header:"Famille",               adjust:"data" ,	format: function(value){return value.nom;} },
                        { id:"modePaiement",        	sort:"server",		header:"Mode de paiement",      adjust:"data",	format: function(value){return value.type + " - " + value.code + " - " + value.libelle;} },
                        { id:"telephone",               sort:"server",		header:"Téléphone",             adjust:"data" },
                        { id:"adresse",                 sort:"server",		header:"Adresse",			    adjust:"data" },
                        { id:"codePostal",              sort:"server",	    header:"CP",				    adjust:"data" },
                        { id:"ville",                   sort:"server",		header:"Ville",				    adjust:"data" }
                    ],
                    autoConfig:true,
                    pager: {
                        container:"paging_here",
                        template: '{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}',
                        size:50,
                        group:8
                    },
                    on:{
                        onSelectChange:function(){
                            var text = "Selected: "+grida.getSelectedId(true).join();
                            document.getElementById('selectedRow').innerHTML = text;
                            window.location.href = "te_client_factures.html?client_id=" + grida.getSelectedId(true).join();
                        }
                    },

                    url:"http://localhost:9090/textma/teClients?search="+document.getElementById("myfilter").value
                });

                grida.getPager().clone({
                    container:"select_page",
                    template: function(data, common){
                                var current = data.page + 1;
                                var html = "Page <select onchange='grida.setPage(this.value)' style='text-align:center; width:150px'>";
                                for (var i=1; i<=data.limit; i++)
                                    html+="<option "+(i == current?"selected='true'":"")+">"+i+"</option>";
                                html+="</select> from "+data.limit;
                                return html;
                            },
                    size:20,
                    group:8
                });
            });

            //show hide columns
            function showHideColumnMenu(){
                if( $$("showHideColumnsMenu").config.hidden){
                    $$("showHideColumnsMenu").show();
                }
                else
                    $$("showHideColumnsMenu").hide();
            }

            function showOrHideColumn(columnId) {
                if (grida.isColumnVisible(columnId)) {
                    grida.hideColumn(columnId);
				} else {
                    grida.showColumn(columnId);
				}
			}

            webix.ui({
                view: "sidemenu",
                id: "showHideColumnsMenu",
                width: 300,
				height: 100,
                position: "right",
                css: "rightSideMenu",
                body:{
                    view:"list",
                    borderless:true,
                    scroll: false,

                    template: "<button onclick=showOrHideColumn('#id#') class='btn button_raised col-md-12 bg_success'>#value#</button>",
//                    template: "<div class='form-group row'><div class='form-check'><label class='form-check-label'><input class='form-check-input' type='checkbox' onclick=showOrHideColumn('#id#')>#value#</label></div></div>",
                    data:[
                        {id:"m",                    value: "M"},
                        {id:"bloque",				value: "Bloqué"},
                        {id:"ferme",				value: "Fermé"},
                        {id:"derniereModification", value: "Date de modification"},
                        {id:"codeClient",			value: "Code"},
                        {id:"nom",                  value: "Société"},
                        {id:"siret",                value: "Siret"},
                        {id:"rcs",                  value: "RCS"},
                        {id:"famille",              value: "Famille"},
                        {id:"modePaiement",         value: "Mode de paiement"},
                        {id:"telephone",            value: "Téléphone"},
                        {id:"adresse",              value: "Adresse"},
                        {id:"codePostal",           value: "Code postal"},
                        {id:"ville",                value: "Ville"}

                    ],
                    select:true,
                    type:{
                        height: 40
                    }
                }
            });

		</script>
	</body>
</html>