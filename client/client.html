<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>Client</title>
		<link rel="stylesheet" href="../include/css/bootstrap.css" type="text/css" charset="utf-8">
		<link rel="stylesheet" href="../include/css/webix.css" type="text/css" charset="utf-8">
		<link rel="stylesheet" href="../include/css/material.css" type="text/css" charset="utf-8">

		<script src="../include/js/tether.js" type="text/javascript" charset="utf-8"></script>
		<script src="../include/js/jquery.js" type="text/javascript" charset="utf-8"></script>
		<script src="../include/js/bootstrap.js" type="text/javascript" charset="utf-8"></script>
		<script src="../include/js/webix.js" type="text/javascript" charset="utf-8"></script>
		<script src="../include/js/skin.js" type="text/javascript" charset="utf-8"></script>
		<script src="../include/js/common.js" type="text/javascript" charset="utf-8"></script>

	</head>
	<body>

		<div id="menu"></div>

		<h1>Client</h1>

		<ul class="nav nav-tabs" role="tablist">
			<li class="nav-item">
				<a class="nav-link active" href="#general" role="tab" data-toggle="tab">Général</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#contacts" role="tab" data-toggle="tab">Contacts</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#adresses_livraison" role="tab" data-toggle="tab">Adresses de livraison</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#remises" role="tab" data-toggle="tab">Remises</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#observations" role="tab" data-toggle="tab">Observations</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#sous_clients" role="tab" data-toggle="tab">Sous clients</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#tableau_de_bord" role="tab" data-toggle="tab">Tableau de bord</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#statistiques" role="tab" data-toggle="tab">Statistiques</a>
			</li>
		</ul>

		<!-- Tab panes -->
		<div class="tab-content">

			<!--Onglet Général-->
			<div role="tabpanel" class="tab-pane active" id="general">Général</div>

			<!--Onglet Contacts-->
			<div role="tabpanel" class="tab-pane" id="contacts">
				<div id="my_form"></div>
			</div>

			<!--Onglet Adresses livraison-->
			<div role="tabpanel" class="tab-pane fade" id="adresses_livraison">
				<button class="bg_danger col-md-2" onclick="document.location='client.html'"><span class="mif-plus"></span> Création</button>
				<button class="bg_warning col-md-5" onclick="document.location='client.html'"><span class="mif-play"></span> Modification </button>
				<button class="button bg_info col-md-3" onclick="document.location='client.html'"><span class="mif-loop2"></span> Duplication</button>
			</div>

			<!--Onglet Remise-->
			<div role="tabpanel" class="tab-pane" id="remises">Remise</div>

			<!--Onglet Observation-->
			<div role="tabpanel" class="tab-pane" id="observations">
				<textarea></textarea>
			</div>

			<!--Onglet Sous clients-->
			<div role="tabpanel" class="tab-pane" id="sous_clients"><div id="gridSousClients"></div>
				<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#listClientModal">
				Ajouter un sous client
			</button></div>

			<!--Onglet Tableau de bord-->
			<div role="tabpanel" class="tab-pane" id="tableau_de_bord">Tableau de bord</div>

			<!--Onglet Statistiques-->
			<div role="tabpanel" class="tab-pane" id="statistiques">Statistiques</div>
		</div>

		<!-- List client Modal -->
		<div class="modal fade" id="listClientModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog" style="max-width: 1200px" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLabel">List des clients</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<div id="gridAllClients"></div>
					</div>
					<div class="modal-footer">
						<div id="pagingAllClients"></div>
					</div>
				</div>
			</div>
		</div>


		<script type="text/javascript" charset="utf-8">

			webix.ready(function(){
				var idClient = getUrlVariable('client_id', window.location.href);
				console.log("idClient: ", idClient);
				var clientForm = [
					{ view:"text", label:"Name", name:"name", width: 500, css:"bg_success"},
					{ view:"text",  label:"Adresse", name:"address", width: 500},
					{ view:"button",  name:"submit", value:"Submit", css:"button_success button_raised", width:200, click:function(){
						var form = this.getParentView();
						webix.ajax().post("http://localhost:9090/textma/teClients", form.getValues(), function(text, data, xhr){ });
					}}
				];


				webix.ui({
					view:"form",
					container:"my_form",
					elements: clientForm,
					url: "http://localhost:9090/textma/teClients/"+idClient
				});


                // Grid sous clients
                gridSousClients = webix.ui({
                    container:"gridSousClients",
                    view:"datatable",
                    select:"row",
                    autowidth:true,
                    autoheight:true,
                    datafetch:20,
                    autoConfig:true,
                    editable:true,
                    columns: [
                        {id: "codeClient", sort: "server", header: "Code", adjust: "head"},
                        {id: "nom", sort: "server", header: "Société", adjust: "data"},
                        {id: "siret", sort: "server", header: "Siret", adjust: "data"},
                        {
                            id: "totalFacture",
                            sort: "server",
                            header: "Total facture",
                            adjust: "data",
                            format: webix.Number.numToStr({
                                groupDelimiter: " ",
                                groupSize: 3,
                                decimalDelimiter: ",",
                                decimalSize: 2
                            })
                        },
                        {id: "rcs", sort: "server", header: "RCS", adjust: "data"},
                        {
                            id: "derniereModification",
                            sort: "server",
                            header: "Modification",
                            adjust: "head",
                            format: formatDatetime
                        },
                        {
                            id: "famille", sort: "server", header: "Famille", adjust: "data", format: function (value) {
                            return value.nom;
                        }
                        },
                        {
                            id: "modePaiement",
                            sort: "server",
                            header: "Mode de paiement",
                            adjust: "data",
                            format: function (value) {
                                return value.type + " - " + value.code + " - " + value.libelle;
                            }
                        },
                        {id: "telephone", sort: "server", header: "Téléphone", adjust: "data"},
                        {id: "adresse", sort: "server", header: "Adresse", adjust: "data"},
                        {id: "codePostal", sort: "server", header: "CP", adjust: "data"},
                        {id: "ville", sort: "server", header: "Ville", adjust: "data"}
                    ],

                    url:"http://localhost:9090/textma/teClients/sous-client/" + idClient
                });

                gridAllClients = webix.ui({
                    container: "gridAllClients",
                    view: "datatable",
                    select: "row",
					width: 1150,
					autoWidth: true,
                    height: (window.innerHeight * 0.7),
                    datafetch: 20,
                    dragColumn: true,
                    columns: [
                        {id: "codeClient", sort: "server", header: "Code", adjust: "head"},
                        {id: "nom", sort: "server", header: ["Société",{content:"serverFilter"}], adjust: "data"},
                        {id: "siret", sort: "server", header: "Siret", adjust: "data"},
                        {id: "famille", sort: "server", header: "Famille", adjust: "data", format: function (value) {return value.nom;}}
                    ],
                    autoConfig: true,
                    pager: {
                        container: "pagingAllClients",
                        template: '{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}',
                        size: 20,
						width: 500,
                        group: 8
                    },
                    on: {
                        onSelectChange: function () {
//                            window.location.href = "client.html?client_id=" + gridAllClients.getSelectedId(true).join();
//							call WS
                            $('#listClientModal').modal('hide');
//                            gridAllClients.reload;
                        }
                    },
                    url: "http://localhost:9090/textma/teClients"
                });
			});
		</script>
	</body>
</html>