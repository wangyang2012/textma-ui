<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>Client</title>
		<link rel="stylesheet" href="../include/css/bootstrap.css" type="text/css" charset="utf-8">
		<link rel="stylesheet" href="../include/css/webix.css" type="text/css" charset="utf-8">
		<link rel="stylesheet" href="../include/css/material.css" type="text/css" charset="utf-8">
		<link rel="stylesheet" href="../include/css/common.css" type="text/css" charset="utf-8">
		<link rel="stylesheet" href="../include/css/client.css" type="text/css" charset="utf-8">

		<script src="../include/js/tether.js" type="text/javascript" charset="utf-8"></script>
		<script src="../include/js/jquery.js" type="text/javascript" charset="utf-8"></script>
		<script src="../include/js/jquery-ui.js" type="text/javascript" charset="utf-8"></script>
		<script src="../include/js/bootstrap.js" type="text/javascript" charset="utf-8"></script>
		<script src="../include/js/webix.js" type="text/javascript" charset="utf-8"></script>
		<script src="../include/js/skin.js" type="text/javascript" charset="utf-8"></script>
		<script src="../include/js/common.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<body>

		<div id="menu"></div>

		<h1>Client</h1>

		<ul class="nav nav-tabs" role="tablist">
			<li class="nav-item">
				<a class="nav-link active" href="#general" role="tab" data-toggle="tab">Général</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#contacts" role="tab" data-toggle="tab">Contacts</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#adresses_livraison" role="tab" data-toggle="tab">Adresses de livraison</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#remises" role="tab" data-toggle="tab">Remises</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#observationsDiv" role="tab" data-toggle="tab">Observations</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#sous_clients" role="tab" data-toggle="tab">Sous clients</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#tableau_de_bord" role="tab" data-toggle="tab">Tableau de bord</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#statistiques" role="tab" data-toggle="tab">Statistiques</a>
			</li>
		</ul>

		<!-- Tab panes -->
		<div id="clientFormDiv">
			<form class="myform" id="clientForm" >
				<div class="tab-content">

					<!--Onglet Général-->
					<div role="tabpanel" class="tab-pane active" id="general">

                        <!-- Informations -->
                        <div class="card col-md-6 pull-left draggable">
                            <div class="card-header">
                                <h4 class="card-title pull-left">Informations</h4>
                                <button class="btn btn-primary pull-right" type="button" data-toggle="collapse" data-target="#blockInformations" aria-expanded="true" aria-controls="blockInformations">
                                    <span class='webix_icon fa-angle-down'></span>
                                </button>
                            </div>
                            <div class="card-block collapse show" id="blockInformations">
                                <div id="divGeneralInformations"></div>
                            </div>
                        </div>

                        <!-- Adresse -->
                        <div class="card col-md-6 pull-right draggable">
                            <div class="card-header">
                                <h4 class="card-title pull-left">Adresse</h4>
                                <button class="btn btn-primary pull-right" type="button" data-toggle="collapse" data-target="#blockAdresse" aria-expanded="true" aria-controls="blockAdresse">
                                    <span class='webix_icon fa-angle-down'></span>
                                </button>
                            </div>
                            <div class="card-block collapse show" id="blockAdresse">
                                <div id="divGeneralAdresse"></div>
                            </div>
                        </div>

						<!-- Paiement -->
						<div class="card col-md-6 pull-right draggable">
							<div class="card-header">
								<h4 class="card-title pull-left">Paiement</h4>
								<button class="btn btn-primary pull-right" type="button" data-toggle="collapse" data-target="#blockPaiement" aria-expanded="true" aria-controls="blockPaiement">
									<span class='webix_icon fa-angle-down'></span>
								</button>
							</div>
							<div class="card-block collapse show" id="blockPaiement">
								<div id="divGeneralPaiement"></div>
							</div>
						</div>

                        <!-- Coordonnées -->
                        <div class="card col-md-6 pull-left draggable">
                            <div class="card-header">
                                <h4 class="card-title pull-left">Coordonnées</h4>
                                <button class="btn btn-primary pull-right" type="button" data-toggle="collapse" data-target="#blockCoordonnees" aria-expanded="true" aria-controls="blockCoordonnees">
                                    <span class='webix_icon fa-angle-down'></span>
                                </button>
                            </div>
                            <div class="card-block collapse show" id="blockCoordonnees">
                                <div id="divGeneralCoordonnees"></div>
                            </div>
                        </div>

						<div class="btn-group draggable" role="group" aria-label="Basic example">
							<button type="button" class="btn btn-secondary bg_info" onclick="document.location='te_client_list.html'"> Retour </button>
							<button type="button" class="btn btn-secondary bg_danger ml-1" onclick="deleteClient()"> Supprimer </button>
							<button type="button" class="btn btn-secondary bg_warning ml-1" onclick="save()"> Enregistrer </button>
						</div>
					</div>

					<!--Onglet Contacts-->
					<div role="tabpanel" class="tab-pane" id="contacts">
						<div id="gridContacts"></div>
						<div class="row col-md-12">
							<div id="pagerContacts" class="col-md-10"></div>
							<button type="button" class="btn btn-secondary bg_primary col-md-1" onclick="createNewContact()"> Nouveau contact </button>
						</div>
					</div>

					<!--Onglet Adresses livraison-->
					<div role="tabpanel" class="tab-pane fade" id="adresses_livraison">
                        <div id="gridLivraisons"></div>
                        <div id="pagerLivraisons"></div>
					</div>

					<!--Onglet Remise-->
					<div role="tabpanel" class="tab-pane" id="remises" style="height: 800px;overflow: auto;">
						<div class="row">
							<div class="col-md-6">
								<input id="treeRemiseFilterInput" onkeyup="filterTree(this.value)"/>
								<div id="treeRemiseDiv">
									<div id="treeRemise"></div>
								</div>
							</div>
							<div class="col-md-6" id="formRemiseDiv"></div>
						</div>

						<!--https://docs.webix.com/desktop__edit.html-->
						<!--https://docs.webix.com/desktop__data_binding.html-->
					</div>

					<!--Onglet Observations-->
					<div role="tabpanel" class="tab-pane" id="observationsDiv">
						<textarea name="observations" id="observations" class="col-md-8" style="min-height: 600px"></textarea>
					</div>


					<!--Onglet Sous clients-->
					<div role="tabpanel" class="tab-pane" id="sous_clients"><div id="gridSousClients"></div>
						<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#listClientModal">
						Ajouter un sous client
					</button></div>

					<!--Onglet Tableau de bord-->
					<div role="tabpanel" class="tab-pane" id="tableau_de_bord">Tableau de bord</div>

					<!--Onglet Statistiques-->
					<div role="tabpanel" class="tab-pane" id="statistiques">
                        <div id="pageSelecterFactures"></div>
                        <div id="gridFactures"></div>
                        <div id="pagerFactures"></div>
                    </div>

				</div>

			</form>
		</div>

		<!-- List client Modal -->
		<div class="modal fade" id="listClientModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog" style="max-width: 1200px" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLabel">List des clients</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<div id="gridAllClients"></div>
					</div>
					<div class="modal-footer">
						<div id="pagingAllClients"></div>
					</div>
				</div>
			</div>
		</div>


		<script type="text/javascript" charset="utf-8">

            idClient = getUrlVariable('client_id', window.location.href);

            webix.ready(function(){

				// form
                webix.ui({
                    container: "clientFormDiv",
                    view:"htmlform",
                    id:"clientForm"
                });

				// Onglet Général
                // Informations
                webix.ui({
                    view:"form",  id:"informationsForm", container: "divGeneralInformations", complexData:true,
                    elements:[
                        { label:"Code client", view:"text", name:"codeClient", validate:webix.rules.isNumber, labelWidth: 200},
                        { label:"Société", view:"text", name:"nom", labelWidth: 200},
                        { label:"Famille", view:"richselect", options:"http://"+serverIP+":9090/textma/teFamilleClients?count=1000", name:"famille.id", labelWidth: 200},
                        { label:"Forme juridique", view:"richselect", options:"http://"+serverIP+":9090/textma/formeJuridiques", name:"formeJuridique.id", labelWidth: 200},
                        { label:"N° TVA", view:"text", name:"numeroTva", labelWidth: 200},
                        { label:"SIRET", view:"text", name:"siret", labelWidth: 200},
                        { label:"RCS", view:"text", name:"rcs", labelWidth: 200},
                        { label:"Ouverture de compte", view:"text", name:"ouvertureCompte", labelWidth: 200},
                        { label:"Total factures", view:"text", name:"totalFacture", disabled:true, labelWidth: 200}
                    ],
                    url: "http://"+serverIP+":9090/textma/teClients/"+idClient
                });

                // Adresse
                webix.ui({
                    view:"form",  id:"adressesForm", container: "divGeneralAdresse", complexData:true,
                    elements:[
                        { label:"Adresse", view:"text", name:"adresse", labelWidth: 200},
                        { label:"Code postal", view:"text", name:"codePostal", labelWidth: 200},
                        { label:"Ville", view:"text", name:"ville", labelWidth: 200},
                        { label:"Pays", view:"text", name:"pays", labelWidth: 200},
						{ value:"Transférer en adresse de livraison", view:"button", click: function() {
                            transfertToDeliveryAddress();
						}}
                    ],
                    url: "http://"+serverIP+":9090/textma/teClients/"+idClient
                });
                // Coordonnées
                webix.ui({
                    view:"form",  id:"coordonneesForm", container: "divGeneralCoordonnees", complexData:true,
                    elements:[
                        { label:"Téléphone", view:"text", name:"telephone", labelWidth: 200 },
                        { label:"Télécopie", view:"text", name:"fax", labelWidth: 200},
                        { label:"Email", view:"text", name:"email", labelWidth: 200},
                        { label:"Site web", view:"text", name:"url", labelWidth: 200}
                    ],
                    url: "http://"+serverIP+":9090/textma/teClients/"+idClient
                });
                // Paiement
                webix.ui({
                    view:"form",  id:"paiementForm", container: "divGeneralPaiement", complexData:true,
                    elements:[
                        { label:"Mode de paiement", view:"richselect", options:"http://"+serverIP+":9090/textma/modePaiements", name:"modePaiement.id", labelWidth: 200},
                        { label:"Commercial interne", view:"richselect", options:"http://"+serverIP+":9090/textma/commercial_internes", name:"commercialInterne.id", labelWidth: 200},
                        { label:"Représentant", view:"richselect", options:"http://"+serverIP+":9090/textma/representants", name:"representant.id", labelWidth: 200},
                        { label:"Escompte(%)", view:"text", name:"escompte", validate:webix.rules.isNumber, labelWidth: 200},
                        { label:"Solde du", view:"text", name:"soldeDu", disabled:true, labelWidth: 200},
                        { label: "Virement", view:"checkbox", name:"virement", labelWidth: 200},
                        { label: "Surveillance société.com", view:"checkbox", name:"surveillanceSocieteCom", labelWidth: 200},
                        { label: "Mauvais payeur", view:"checkbox", name:"mauvaisPayeur", labelWidth: 200},
                        { label: "Bloqué", view:"checkbox", name:"bloque", labelWidth: 200},
						{ label: "Fermé", view:"checkbox", name:"ferme", labelWidth: 200}

                    ],
                    url: "http://"+serverIP+":9090/textma/teClients/"+idClient
                });

                // Onglet Contacts
                gridContacts = webix.ui({
                    container: "gridContacts",
                    view: "datatable",
                    select: "row",
                    height: (window.innerHeight * 0.75),
					autowidth:true,
                    datafetch: 20,
                    dragColumn: true,
                    columns: [
                        {id: "civilite", sort: "server", header: "Civilité", adjust: "head"},
                        {id: "nom", sort: "server", header: "Nom", adjust: "data"},
                        {id: "prenom", sort: "server", header: "Prénom", adjust: "data"},
                        {id: "fonction", sort: "server", header: "Fonction", adjust: "data", format: function (value) {return value.nom;}},
                        {id: "email", sort: "server", header: "Email", adjust: "data", validate:webix.rules.isEmail},
                        {id: "portable", sort: "server", header: "Portable", adjust: "data"},
                        {id: "telephone", sort: "server", header: "Téléphone", adjust: "data"},
                        {id: "fax", sort: "server", header: "Fax", adjust: "data"},
                        {id: "facturation", sort: "server", header: "Facturation", adjust: "head",checkValue: '1', uncheckValue: '0', template: "{common.checkbox()}"},
                        {id: "logistique", sort: "server", header: "Logistique", adjust: "head",checkValue: '1', uncheckValue: '0', template: "{common.checkbox()}"},
                        {id: "commercial", sort: "server", header: "Commercial", adjust: "head",checkValue: '1', uncheckValue: '0', template: "{common.checkbox()}"}
                    ],
                    autoConfig: true,
                    pager: {
                        container: "pagerContacts",
                        template: '{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()} total: #count#',
						width: 500,
                        size: 20,
                        group: 8
                    },
					on: {
                        onSelectChange: function () {
                            showContactForm(gridContacts.getSelectedId(true).join());
                        }
					},
                    url: "http://"+serverIP+":9090/textma/teContacts/client/" + idClient
                });

                // contactForm = webix.ui();
                contactFormWindow = webix.ui({
                    view:"window",
                    id:"contactFormWindow",
                    width:600,
					autoheight:true,
                    position:"center",
                    modal:true,
                    // head:"Contact",
                    head:{
                        view:"toolbar", cols:[
                            {view:"label", label: "Contact" },
                            { view:"button", label: 'Fermer', width: 100, align: 'right', click:"$$('contactFormWindow').hide();"}
                        ]
                    },
                    body:{
                        view:"form",  id:"contactForm", complexData:true,
                        width: 600,
						autoheight:true,
                        elements:[
                            { label:"Id", view:"text", name:"id", labelWidth: 150, css:"hidden"},
                            { label:"Client", view:"text", name:"client.id", labelWidth: 150, css:"hidden"},
                            { label:"Civilité", view:"text", name:"civilite", labelWidth: 150},
                            { label:"Nom", view:"text", name:"nom", labelWidth: 150},
                            { label:"Prénom", view:"text", name:"prenom", labelWidth: 150},
                            { label:"Fonction", view:"richselect", options:"http://"+serverIP+":9090/textma/teFonctionContacts", name:"fonction.id", labelWidth: 150},
                            { label:"Email", view:"text", name:"email", labelWidth: 150},
                            { label:"Portable", view:"text", name:"portable", labelWidth: 150},
                            { label:"Téléphone", view:"text", name:"telephone", labelWidth: 150},
                            { label:"Fax", view:"text", name:"fax", labelWidth: 150},
                            { label:"Facturation", view:"checkbox", name:"facturation", labelWidth: 150},
                            { label:"Logistique", view:"checkbox", name:"logistique", labelWidth: 150},
                            { label:"Commercial", view:"checkbox", name:"commercial", labelWidth: 150},
                            {
                                cols: [
                                    {label: "Supprimer", view: "button", align: "right", click: "deleteContact()", css: "btn btn-secondary danger"},
                                    {label: "Enregistrer", view: "button", align: "right", click: "saveContactForm()", css: "btn btn-secondary primary"}
                                ]
                            }
                        ]
                    }
                });

                function showContactForm(idContact){
                    $$("contactForm").load("http://"+serverIP+":9090/textma/teContacts/"+idContact);
                    contactFormWindow.show();
                }


                // Onglet Adresses livraison
                gridLivraisons = webix.ui({
                    container: "gridLivraisons",
                    view: "datatable",
                    select: "row",
                    height: (window.innerHeight * 0.75),
                    width: (window.innerWidth * 0.99),
                    datafetch: 20,
                    dragColumn: true,
                    columns: [
                        {id: "nomSociete", sort: "server", header: "Nom Société", adjust: "data"},
                        {id: "adresse", sort: "server", header: "Adresse", adjust: "data"},
                        {id: "codePostal", sort: "server", header: "CodePostal", adjust: "head"},
                        {id: "ville", sort: "server", header: "Ville", adjust: "data"},
                        {id: "telephone", sort: "server", header: "Téléphone", adjust: "head"},
                        {id: "fax", sort: "server", header: "Fax", adjust: "data"},
                        {id: "email", sort: "server", header: "Email", adjust: "head", validate:webix.rules.isEmail},
                        {id: "observations", sort: "server", header: "Observations", adjust: "head"}
                    ],
                    autoConfig: true,
                    pager: {
                        container: "pagerLivraisons",
                        template: '{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()} total: #count#',
                        width: 500,
                        size: 20,
                        group: 8
                    },
                    url: "http://"+serverIP+":9090/textma/teAdresses/" + idClient
                });

                livraisonFormWindow = webix.ui({
                    view:"window",
                    id:"livraisonFormWindow",
                    width:600,
                    autoheight:true,
                    position:"center",
                    modal:true,
                    head:{
                        view:"toolbar", cols:[
                            {view:"label", label: "Adresses de livraison" },
                            { view:"button", label: 'Fermer', width: 100, align: 'right', click:"$$('livraisonFormWindow').hide();"}
                        ]
                    },
                    body:{
                        view:"form",  id:"contactForm", complexData:true,
                        width: 600,
                        autoheight:true,
                        elements:[
                            { label:"Id", view:"text", name:"id", labelWidth: 150, css:"hidden"},
                            { label:"Société", view:"text", name:"nom", labelWidth: 150},
                            { label:"Adresse", view:"text", name:"prenom", labelWidth: 150},
                            { label:"Code postal", view:"richselect", options:"http://"+serverIP+":9090/textma/teFonctionContacts", name:"fonction.id", labelWidth: 150},
                            { label:"Ville", view:"text", name:"email", labelWidth: 150},
                            { label:"Téléphone", view:"text", name:"telephone", labelWidth: 150},
                            { label:"Fax", view:"text", name:"fax", labelWidth: 150},
                            { label:"Email", view:"checkbox", name:"facturation", labelWidth: 150},
                            { label:"Observations", view:"checkbox", name:"logistique", labelWidth: 150},
                            {
                                cols: [
                                    {label: "Supprimer", view: "button", align: "right", click: "deleteAdresseLivraison()", css: "btn btn-secondary danger"},
                                    {label: "Enregistrer", view: "button", align: "right", click: "saveAdresseLivraison()", css: "btn btn-secondary primary"}
                                ]
                            }
                        ]
                    }
                });


				// Onglet Remise
                formRemise = webix.ui({
                    container:"formRemiseDiv",
                    complexData:true,
                    view:"form",
                    minWidth: "400",
                    elements:[
                        { label:"Libellé", view:"text", name:"libelle" },
                        { label:"Remise(%)", view:"text", name:"remise"},
                        { label:"Remise(€)", view:"text", name:"prix"},
                        { label:"Rotation(%)", view:"text", name:"rotationPourcentage"},
                        { label:"Rotation(€)", view:"text", name:"reotationPrix"}
                    ],
                });

                treeRemise = webix.ui({
                    container:"treeRemise",
					id:"treeRemise",
                    view:"tree",
                    select:true,
                    minWidth:"400",
                    minHeight:"50%",
                    template:"{common.icon()} {common.folder()} <span>#value#</span>",
                    filterMode:{
                        level:4
                    },
                    url: "http://"+serverIP+":9090/textma/remise/"+idClient,
                    on: {
                        onAfterSelect: function (id) {
                            url = "http://"+serverIP+":9090/textma/remise/"+idClient+"/"+id;
                            console.log(url);
                            formRemise.load(url);
						}
                    },
                });


                // Grid sous clients
                gridSousClients = webix.ui({
                    container:"gridSousClients",
                    view:"datatable",
                    select:"row",
                    autowidth:true,
                    autoheight:true,
                    datafetch:20,
                    autoConfig:true,
                    editable:true,
                    columns: [
                        {id: "codeClient", sort: "server", header: "Code", adjust: "head"},
                        {id: "nom", sort: "server", header: "Société", adjust: "data"},
                        {id: "siret", sort: "server", header: "Siret", adjust: "data"},
                        {
                            id: "totalFacture",
                            sort: "server",
                            header: "Total facture",
                            adjust: "data",
                            format: webix.Number.numToStr({
                                groupDelimiter: " ",
                                groupSize: 3,
                                decimalDelimiter: ",",
                                decimalSize: 2
                            })
                        },
                        {id: "rcs", sort: "server", header: "RCS", adjust: "data"},
                        {
                            id: "derniereModification",
                            sort: "server",
                            header: "Modification",
                            adjust: "head",
                            format: formatDatetime
                        },
                        {
                            id: "famille", sort: "server", header: "Famille", adjust: "data", format: function (value) {
                            return value.nom;
                        }
                        },
                        {
                            id: "modePaiement",
                            sort: "server",
                            header: "Mode de paiement",
                            adjust: "data",
                            format: function (value) {
                                return value.type + " - " + value.code + " - " + value.libelle;
                            }
                        },
                        {id: "telephone", sort: "server", header: "Téléphone", adjust: "data"},
                        {id: "adresse", sort: "server", header: "Adresse", adjust: "data"},
                        {id: "codePostal", sort: "server", header: "CP", adjust: "data"},
                        {id: "ville", sort: "server", header: "Ville", adjust: "data"}
                    ],

                    url:"http://"+serverIP+":9090/textma/teClients/sous-client/" + idClient
                });

                gridAllClients = webix.ui({
                    container: "gridAllClients",
                    view: "datatable",
                    select: "row",
					width: 1150,
					autoWidth: true,
                    height: (window.innerHeight * 0.7),
                    datafetch: 20,
                    dragColumn: true,
                    columns: [
                        {id: "codeClient", sort: "server", header: "Code", adjust: "head"},
                        {id: "nom", sort: "server", header: ["Société",{content:"serverFilter"}], adjust: "data"},
                        {id: "siret", sort: "server", header: "Siret", adjust: "data"},
                        {id: "famille", sort: "server", header: "Famille", adjust: "data", format: function (value) {return value.nom;}}
                    ],
                    autoConfig: true,
                    pager: {
                        container: "pagingAllClients",
                        template: '{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()} total: #count#',
                        size: 20,
						width: 500,
                        group: 8
                    },
                    on: {
                        onSelectChange: function () {
//                            window.location.href = "client.html?client_id=" + gridAllClients.getSelectedId(true).join();
//							call WS
                            $('#listClientModal').modal('hide');
//                            gridAllClients.reload;
                        }
                    },
                    url: "http://"+serverIP+":9090/textma/teClients"
                });


                gridFactures = webix.ui({
                    container:"gridFactures",
                    view:"datatable",
                    select:"row",
                    autowidth:true,
                    height: (window.innerHeight * 0.7),
                    datafetch:20,
                    autoConfig:true,
                    editable:true,
                    columns:[
                        { id:"numeroFacture", sort: "server",			header:"Numéro facture", adjust:"head"},
                        { id:"reference", sort: "server",				header:"Référence", adjust: "data"},
                        { id:"raisonSociale", sort: "server", editor:"text",			header:"Raison sociale", adjust: "data"},
                        { id:"dateCreation", sort: "server",			header:"Date de création", format: formatDatetime, adjust: "head"},
                        { id:"totalHt", sort: "server",	  editor:"text",				header:"Total HT", adjust: "head"},
                        { id:"totalTva", sort: "server",  editor:"text",				header:"Total TVA", adjust: "head"},
                        { id:"totalTtc", sort: "server", editor:"text",				header:"Total TTC", adjust: "head"},
                        { id:"adresse", sort: "server",	 editor:"text",				header:"Adresse", adjust: "data"},
                    ],
                    pager: {
                        container:"pagerFactures",
                        template: '{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()} total: #count#',
                        size:20,
                        width: 600,
                        group:8
                    },

                    url:"http://"+serverIP+":9090/textma/teFactures/" + idClient
                });

                gridFactures.getPager().clone({
                    container:"pageSelecterFactures",
                    template: function(data, common){
                        var current = data.page + 1;
                        var html = "Page <select onchange='gridFactures.setPage(this.value)' style='text-align:center; width:150px'>";
                        for (var i=1; i<=data.limit; i++)
                            html+="<option "+(i == current?"selected='true'":"")+">"+i+"</option>";
                        html+="</select> from "+data.limit;
                        return html;
                    },
                    size:20,
                    width: 250,
                    group:8
                });
			});

			function filterTree(value) {
			    if (value.length > 2) {
                    treeRemise.filter("#value#", value);
                } else if(value.length == 0) {
			        treeRemise.filter("#value#", "");
			        treeRemise.closeAll();

				}
			}

			function save() {
				var informationValues = $$("informationsForm").getValues();
                var adresseValues = $$("adressesForm").getValues();
                var coordonneeValues = $$("coordonneesForm").getValues();
                var paiementValues = $$("paiementForm").getValues();

                var clientObject = {id: informationValues.id, codeClient: informationValues.codeClient, nom: informationValues.nom, famille:informationValues.famille, formeJuridique: informationValues.formeJuridique, numeroTva: informationValues.numeroTva, siret: informationValues.siret, rcs: informationValues.rcs, ouvertureCompte: informationValues.ouvertureCompte, totalFacture: informationValues.totalFacture, telephone: coordonneeValues.telephone, fax: coordonneeValues.fax, email: coordonneeValues.email, url: coordonneeValues.url,
					adresse: adresseValues.adresse, codePostal: adresseValues.codePostal, ville: adresseValues.ville, pays: adresseValues.pays, modePaiement: paiementValues.modePaiement, commercialInterne: paiementValues.commercialInterne, representant: paiementValues.representant,
                    escompte: paiementValues.escompte, soldeDu: 0, virement: paiementValues.virement, surveillanceSocieteCom: paiementValues.surveillanceSocieteCom, mauvaisPayeur:paiementValues.mauvaisPayeur,
					bloque: paiementValues.bloque, ferme: paiementValues.ferme};
//                	webix.send("http://"+serverIP+":9090/textma/teClients", clientObject);
					webix.ajax().headers({
                        "Content-type": "application/json"
                    }).put("http://"+serverIP+":9090/textma/teClients", clientObject, function(text, data, xhr){
                        messageAlert("Enregistrement", "L'enregistrement réussi!", function(){
                            document.location='te_client_list.html';
                        });
					});
            }

            function transfertToDeliveryAddress() {
                var adresseValues = $$("adressesForm").getValues();
                webix.ajax().headers({
                    "Content-type": "application/json"
                }).post("http://"+serverIP+":9090/textma/teAdresses/"+idClient, adresseValues, function(text, data, xhr){
                    if (text == "ok") {
                        messageAlert("Transfert", "L'adresse est bien transférée en adresse de livraison.");
                        document.location='client.html?client_id='+idClient;
                    }
                });
            }

            function deleteClient() {
                webix.ajax().del("http://"+serverIP+":9090/textma/teClients/"+idClient, function(text, data, xhr){
                    if (text == "ok") {
                        messageAlert("Suppression", "La suppression du client est réussie!", function(){
                            document.location='te_client_list.html';
                        });
                    }
                });
            }

            function createNewContact() {
                $$('contactForm').clear();
                contactFormWindow.show();
            }

            function saveContactForm() {
                var contactFormValues = $$("contactForm").getValues();
                if (contactFormValues.client.id == null || contactFormValues.client.id.length == 0) {
                    contactFormValues.client.id = idClient;
				}
                webix.ajax().headers({
                    "Content-type": "application/json"
                }).put("http://"+serverIP+":9090/textma/teContacts", contactFormValues, function(text, data, xhr){
                    messageAlert("Enregistrement", "L'enregistrement réussi!", function(){
                        gridContacts.clearAll();
                        gridContacts.load("http://"+serverIP+":9090/textma/teContacts/client/" + idClient);
                        contactFormWindow.hide();
                    });
                });
                contactFormWindow.hide();
            }

            function deleteContact() {
                webix.confirm("Suppression", "Etes-vous sûr de vouloir supprimer?", function(){
                    var contactId = $$("contactForm").getValues().id;
                    webix.ajax().del("http://"+serverIP+":9090/textma/teContacts/"+contactId, function(text, data, xhr){
                        gridContacts.clearAll();
                        gridContacts.load("http://"+serverIP+":9090/textma/teContacts/client/" + idClient);
                        contactFormWindow.hide();
                    });
                });
			}
		</script>
	</body>
</html>